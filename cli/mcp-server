#!/bin/bash
set -e
set -o pipefail

# MCP Server entry point for episodic-memory
# This runs the MCP server using stdio transport

# Resolve symlinks to find the actual script directory
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"

# Validate SCRIPT_DIR was resolved successfully
if [ -z "$SCRIPT_DIR" ]; then
  echo "Error: Failed to determine script directory" >&2
  exit 1
fi

# Run the MCP server
(cd "$SCRIPT_DIR/.." && npx tsx "./src/mcp-server.ts" "$@")
exit $?
